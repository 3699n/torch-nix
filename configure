#!/bin/bash

PKG_PATH=$(pwd)

if ! test -z $DEVTOOLS_LOAD; then
  PKG_PATH="$PKG_PATH/inst"
fi

if [[ "$BUILD_LANTERN" != true ]] && [[ "$BUILD_LANTERN" != 1 ]]; then
  BUILD_LANTERN=""
fi

if [[ "$BUILD_LANTERN" != "" ]]; then
  BUILD_LANTERN_CMD="mkdir -p ../build-lantern \&\& cd ../build-lantern \&\& cmake ../src/lantern -DCMAKE_INSTALL_PREFIX=$PKG_PATH \&\& cmake --build . --target install --config Release --parallel 8"
else
  BUILD_LANTERN_CMD='@echo "*** Skip building Lantern. A pre-built binary will be used."'
fi

cd src
sed -e "s|@BUILD_LANTERN_CMD@|$BUILD_LANTERN_CMD|" Makevars.in > Makevars

PKG_CPPFLAGS = -I../inst/include/ -DRCPP_NO_UNWIND_PROTECT

.PHONY: rename_init lantern
all: lantern $(SHLIB) rename

# TODO: we will need to skip building lantern on CRAN
# thus this step must probably be conditioned on the existence of 
# a directory called `lantern`.
lantern:
	@echo "*** Building lantern!"
	@BUILD_LANTERN_CMD@

rename_init:
	@echo "*** Renaming init"
	"${R_HOME}/bin${R_ARCH_BIN}/Rscript" "../tools/renameinit.R"

rename:
	@echo "*** Renaming torch lib to torchpkg"
	"${R_HOME}/bin${R_ARCH_BIN}/Rscript" "../tools/renamelib.R"

# in order to rename SHLIb must be done.
$(SHLIB) : lantern
rename : $(SHLIB)
RcppExports.o : rename_init
